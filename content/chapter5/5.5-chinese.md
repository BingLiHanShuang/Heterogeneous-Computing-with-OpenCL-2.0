#5.5 设备端排队

OpenCL 2.x版本之前的标准，只允许命令从主机端入队。OpenCL 2.0去除了这个限制，并定义了设备端的命令队列，其允许父内核直接将子内核入队。

设备端任务队列的好处是启用了嵌套并行机制(*nested parallelism*)——一个并行程序中的某个线程，再去开启多个线程[1]。嵌套并行机制常用于，不确定内部某个算法要使用多少个线程的应用中。与单独使用"分叉-连接"(*fork-join*)机制相比，嵌套并行机制中产生的线程，会在其任务完成后销毁。这两种机制的区别如图5.7所示：

![](../../images/chapter5/5-7.png)

图5.7 单独的"分叉-链接"的结果与嵌套并行机制的线程分布对比

单独调用的方式，执行完任务后，线程的生命周期就结束了；嵌套并行将会在任务执行中间产生更多的线程，并在某个子任务完成后，结束线程生命周期。

##5.5.1 创建一个设备端队列

##5.5.2 入队设备端内核

**动态局部内存**

**使用事件强制依赖**

------

[1] J.Reinders. Intel Threading Building Blocks: Outfiting C++ for Multi-Core Processor Parallelism. O'Reilly Media, Inc., Sebastopol. 2007.