#6.3 共享虚拟内存

OpenCL 2.0的一个重要的修订就是支持共享虚拟内存(SVM)。共享虚拟内存属于全局内存，其相当于在主机内存区域上做的扩展，其允许上下文对象上的所有设备能和主机共享这块内存。SVM能将结构体指针作为参数传入内核，这相较之前的标准方便许多。例如，在未使用SVM之前，在主机端创建的链表结构无法传递到内核中，只能一个节点一个节点的传入。那么，2.0之后如何将链表实例通过传参的形式传入内核呢？将内存块拆分成小块的方式不适合OpenCL的内存模型，将其整块传入内核才是真正合理的方式。SVM将打破原先内存模型的限制。

OpenCL 2.0中定义了三种SVM类型：

1. 粗粒度数组SVM
2. 细粒度数组SVM
3. 系统细粒度SVM

读者可以通过表6.1来了解，我们将要讨论的各种SVM。

 | 粗粒度SVM| 细粒度SVM| 系统细粒度SVM|
----|----- |-----|-----|
OpenCL对象 |  数组|数组|无(任意主机端类型)
共享粒度 | 数组 | 字节|字节
分配API | clSVMAlloc|clSVMAlloc|malloc(或类似的C/C++函数或操作)
一致性 | 同步点 | 同步点和选择性原子操作|同步点和选择性原子操作|
显式同步设备端和主机端数据？ |映射/反映射命令|无|无
